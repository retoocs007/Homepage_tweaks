/* === FOG === */

:root{
  --fog-tile: 640px;      /* size of the seamless tile */
  --fog-opacity: 0.05;    /* overall fog strength */
  --fog-speed: 10s;      /* time to drift one tile diagonally */
  --fog-steps: 320;
}

/* Oversized fixed layer that slides by exactly one tile via transform */
body::before{
  content:"";
  position: fixed;
  /* extend one tile beyond each edge so we can slide without exposing gaps */
  top:    calc(var(--fog-tile) * -1);
  left:   calc(var(--fog-tile) * -1);
  right:  calc(var(--fog-tile) * -1);
  bottom: calc(var(--fog-tile) * -1);
  z-index: 2;
  pointer-events: none;
  opacity: var(--fog-opacity);

  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='640' height='640' viewBox='0 0 640 640'>\
  <defs>\
    <filter id='fog' x='0' y='0' width='100%' height='100%'>\
      <feTurbulence type='fractalNoise' baseFrequency='0.012 0.018' numOctaves='2' seed='7' stitchTiles='stitch' result='n'/>\
      <feComponentTransfer in='n'>\
        <feFuncR type='table' tableValues='1 1'/>\
        <feFuncG type='table' tableValues='1 1'/>\
        <feFuncB type='table' tableValues='1 1'/>\
        <feFuncA type='table' tableValues='0 0.12 0.2 0.3 0.42 0.55 0.7 0.85'/>\
      </feComponentTransfer>\
    </filter>\
  </defs>\
  <rect width='640' height='640' filter='url(%23fog)'/>\
</svg>");
  background-size: var(--fog-tile) var(--fog-tile);
  background-repeat: repeat;

  /* GPU-friendly drift */
  animation: fogDrift var(--fog-speed) steps(var(--fog-steps), end) infinite;

  /* performance hints */
  will-change: transform, opacity;
  contain: paint;
  backface-visibility: hidden;
}

/* Move exactly one tile diagonally; start and end frames are identical ? seamless loop */
@keyframes fogDrift{
  from { transform: translate3d(0, 0, 0); }
  to   { transform: translate3d(calc(var(--fog-tile) * -1), calc(var(--fog-tile) * -1), 0); }
}
